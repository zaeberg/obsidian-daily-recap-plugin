# Daily Recap Plugin для Obsidian

Плагин для Obsidian, который автоматически генерирует рабочие отчёты на основе ваших ежедневных заметок. Подходит для командных встреч, стендапов и статусов.

## Особенности

- **Автоматический сбор данных**: Собирает информацию из ежедневных заметок
- **Интеграция с Daily Notes**: Работает с папкой Daily Notes из встроенного плагина Obsidian
- **Определение пропущенных дней**: Выделяет рабочие дни без заметок, отличая их от выходных
- **Настройка секций**: Вы можете выбрать, какие разделы включать в отчёт
- **Пересоздание отчёта**: При повторном нажатии в тот же день отчёт пересоздаётся
- **История отчётов**: Хранит полную историю всех сгенерированных отчётов

## Установка


1. Клонируйте этот репозиторий
2. Перейдите в директорию плагина: `cd obsidian-daily-recap-plugin`
3. Установите зависимости: `npm install`
4. Соберите плагин: `npm run build`
5. Скопируйте папку `build/` в `.obsidian/plugins/` вашего vault
6. Включите плагин в настройках Obsidian

**Важно**: Папка `build/` содержит готовые к использованию файлы плагина (`main.js`, `manifest.json`, `versions.json`). Просто скопируйте её в vault.

## Требования

- Obsidian версии 0.15.0 или выше
- Встроенный плагин **Daily Notes** должен быть настроен
- Ежедневные заметки в формате, описанном ниже

## Формат ежедневных заметок

Ваши ежедневные заметки должны соответствовать любому формату но я выбрал такой:

```markdown
---
type: daily
date: 2024-01-15 09:00
---

## План
- [ ] Задача 1
- [ ] Задача 2
- [ ] Задача 3

## Сегодня
- 09:00 - Начал работу над функцией X
- 10:30 - Встреча с дизайн-командой
- 11:45 - Продолжил реализацию

## Блокеры / вопросы
- Проблема с API endpoint
- Нужно уточнение требований

## Итого
- Сделано: Завершил реализацию функции X
- Не сделал (почему): Заблокирован проблемой с API
- Следующий шаг завтра: Решить проблему с API и начать тестирование
```

**Обязательные элементы:**
- Frontmatter с полями `type: daily` и `date`
- Дата может быть в любом формате, который понимает moment.js
- Заголовки секций должны быть уровня 2 (`##`)

## Использование

### Генерация отчёта

Есть два способа сгенерировать отчёт:

1. **Кнопка на боковой панели**: Нажмите иконку календаря с часами на левой панели Obsidian
2. **Палитра команд**: Нажмите `Ctrl/Cmd + P` и выберите "Generate Daily Recap Report"

### Понимание сгенерированного отчёта

Плагин создаёт файл с именем `YYYY-MM-DD_HH-mm_Recap.md` в папке Daily Notes со следующей структурой:

```markdown
# Work Recap Report

**Generated:** 2024-01-15 12:30

**Period:** 2024-01-08 - 2024-01-15

*Previous report: 2024-01-05 10:00*

---

## Monday, January 8, 2024

### План
- Задача 1
- Задача 2
- Задача 3

### Сегодня
- 09:00 - Работа над задачей 1

---

## Tuesday, January 9, 2024

### План
- Задача A
- Задача B

### Сегодня
- 10:00 - Встреча

---

## Missing Days

- Wednesday, January 10, 2024 No daily note
- Saturday, January 13, 2024 Weekend/Holiday
- Sunday, January 14, 2024 Weekend/Holiday
```

### Элементы отчёта

- **Period**: Период, покрытый отчётом
- **Previous report**: Ссылка на предыдущий отчёт
- **Missing Days**: Список дней без ежедневных заметок:
  - "No daily note" - Рабочие дни, когда вы забыли создать заметку
  - "Weekend/Holiday" - Выходные дни (суббота и воскресенье по умолчанию)

### Повторная генерация

Если вы сгенерируете отчёт, а затем нажмёте кнопку снова в тот же день:
- Старый файл отчёта будет **удалён**
- Будет создан **новый** файл с обновлённым временем
- Период отчёта **сохраняется** (не затирается)

## Настройки

Доступ к настройкам плагина: **Settings → Community Plugins → Daily Recap**

- **Included Sections**: Список секций (заголовков уровня 2), которые нужно включать в отчёт, разделённые запятыми.
  - Пример: `План (3 главных задачи), Сегодня (рабочий лог), Блокеры / вопросы, Итого`
  - Если пусто — включаются все доступные секции

- **Last Report**: Дата и время последнего сгенерированного отчёта (только для информации)

- **Total Reports Generated**: Общее количество созданных отчётов (только для информации)

## Как работает плагин

### Логика генерации

1. **Первый запуск**: Включает все ежедневные заметки от самой старой до сегодняшнего дня
2. **Повторный запуск в новый день**: Включает заметки, начиная с даты последнего рекапа, по сегодняшний день
3. **Повторный запуск в тот же день**: Пересоздаёт отчёт с тем же периодом

### Пример сценария

```
Понедельник 09:00 - Созданы заметки за Mon-Wed
Среда 12:30 - Генерация отчёта → Включает Mon, Tue, Wed
Среда 14:00 - Добавлена запись в среду
Среда 15:00 - Повторная генерация → Включает Mon, Tue, Wed с обновлениями
Пятница 12:30 - Генерация отчёта → Включает Thu, Fri (Wed уже был в предыдущем отчёте)
```

### Интеграция с Daily Notes

Плагин автоматически определяет папку для ежедневных заметок из настроек встроенного плагина Daily Notes и сохраняет отчёты в ту же папку.

## Разработка

### Сборка плагина

```bash
npm run build
```

Компилирует TypeScript файлы из `src/` в папку `build/` вместе с необходимыми метаданными.

### Режим разработки

```bash
npm run dev
```

Запускает watcher, который автоматически пересобирает плагин при изменении исходных файлов.

### Запуск тестов

```bash
npm test
```

Запускает все unit тесты (vitest).

### Структура проекта

```
obsidian-daily-recap-plugin/
├── src/
│   ├── domain/              # Бизнес-логика и сущности
│   │   ├── entities/        # Типы и интерфейсы
│   │   ├── services/        # Сервисы бизнес-логики
│   │   ├── parsers/         # Парсеры контента
│   │   └── utils/           # Утилиты
│   ├── application/         # Use cases
│   │   └── useCases/        # Сценарии использования
│   ├── infrastructure/      # Внешние зависимости
│   │   ├── adapters/        # Адаптеры к Obsidian API
│   │   └── repositories/    # Репозитории данных
│   ├── presentation/        # UI компоненты
│   ├── di/                  # Dependency Injection
│   └── main.ts              # Точка входа плагина
├── tests/
│   └── unit/                # Unit тесты
├── build/                   # Собранный плагин (для Obsidian)
├── package.json
├── tsconfig.json
├── vitest.config.ts
└── esbuild.config.mjs       # Конфигурация сборки
```

### Архитектура

Проект использует **Clean Architecture** с разделением на слои:
- **Domain** - чистая бизнес-логика без зависимостей от Obsidian
- **Application** - use cases для оркестрации процессов
- **Infrastructure** - адаптеры к Obsidian API
- **Presentation** - UI компоненты

Такой подход позволяет легко тестировать бизнес-логику изолированно.

## Кастомизация

### Настройка рабочих дней

По умолчанию рабочими днями считаются понедельник-пятница. Чтобы изменить это:

1. Откройте `src/domain/utils/WorkdayChecker.ts`
2. Измените метод `isWorkday()`:

```typescript
static isWorkday(day: string): boolean {
  const workdays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
  return workdays.includes(day);
}
```

### Настройка секций по умолчанию

Измените `DEFAULT_SETTINGS` в `src/domain/entities/defaultSettings.ts`:

```typescript
export const DEFAULT_SETTINGS: PluginSettings = {
  lastReport: null,
  reports: [],
  includedSections: ['План (3 главных задачи)', 'Сегодня (рабочий лог)'], // Ваши секции
};
```

## Решение проблем

### Ежедневные заметки не обнаруживаются

1. Убедитесь, что встроенный плагин **Daily Notes** настроен в Obsidian
2. Проверьте наличие frontmatter в заметках:
```yaml
---
type: daily
date: 2024-01-15
---
```
3. Поле `date` должно быть в формате, который понимает moment.js

### Секции не попадают в отчёт

1. Проверьте настройку **Included Sections** в настройках плагина
2. Убедитесь, что заголовки секций имеют уровень 2 (`##`)
3. Если список секций пустой, должны включаться все доступные секции

### Отчёт не сохраняется в папке Daily Notes

1. Убедитесь, что встроенный плагин **Daily Notes** включён и настроен
2. Проверьте, что указана папка для заметок в настройках Daily Notes

## Автор

**zaeberg**

## Лицензия

MIT License - см. файл LICENSE для подробностей
