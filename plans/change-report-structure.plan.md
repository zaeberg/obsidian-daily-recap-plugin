# Изменение структуры отчёта: группировка по секциям вместо дней

**Status**: `complete`

## Problem Statement
Сейчас отчёт генерируется с группировкой по дням: для каждого дня создаётся блок `## {дата}`, внутри которого находятся секции `### План`, `### Лог` и другие.

Нужно изменить структуру на группировку по секциям: одна секция `## План` содержит все дни, одна секция `## Лог` содержит все дни и т.д. Дни должны быть представлены как элементы списка с датой.

**Текущий формат:**
```markdown
## Thursday, January 15, 2026
### План
- [ ] Task 1
### Лог
- 09:00 - Work done
```

**Желаемый формат:**
```markdown
## План
- Thursday, January 15, 2026
  - [ ] Task 1
## Лог
- Thursday, January 15, 2026
  - 09:00 - Work done
```

## Questions Resolved
- Q: Какие секции должны попадать в отчёт?
  A: Только те, что указаны в `settings.includedSections` (настраивается пользователем)
- Q: Какой формат даты использовать?
  A: Полный формат: `dddd, MMMM D, YYYY` (например: "Thursday, January 15, 2026")

## Edge Cases & Considerations
- [ ] Пустые секции → Пропускать секцию если нет контента ни в одном дне
- [ ] Нет daily notes → Показывать сообщение "No daily notes found"
- [ ] Нет настроенных секций → Fallback на извлечение всех найденных секций
- [ ] Секция существует но пустая в конкретном дне → Не показывать этот день в секции
- [ ] Разные секции в разных днях → Показывать только те секции что есть в `includedSections`

## Relevant Context
- `src/domain/services/ReportGeneratorService.ts` - Основная логика генерации (строки 68-134: `generateNotesContent`, `generateNoteSection`)
- `src/domain/parsers/SectionExtractor.ts` - Логика извлечения секций из daily notes
- `src/domain/entities/PluginSettings.ts` - Интерфейс настроек с полем `includedSections: string[]`
- `src/presentation/DailyRecapSettingTab.ts` - UI настроек (строки 27-44)

## Feature Steps

- [ ] **Изменить алгоритм генерации: группировка по секциям вместо дней**
  - **Business Value**: Отчёт становится более читаемым и удобным для анализа - можно видеть все планы или все логи вместе
  - **Depends on**: none
  - **Definition of Done**:
    - [ ] Отчёт генерируется с секциями `## {название}` верхнего уровня
    - [ ] Внутри каждой секции дни идут как элементы списка `- {дата}`
    - [ ] Контент каждого дня идёт с отступом (2 пробела) под датой
    - [ ] Используется формат даты `dddd, MMMM D, YYYY`
    - [ ] Пустые секции не отображаются
    - [ ] Секции берутся из `settings.includedSections`
  - **Touches**: `src/domain/services/ReportGeneratorService.ts`

- [ ] **Сохранить совместимость с настройкой includedSections**
  - **Business Value**: Пользователь сохраняет контроль какие секции попадают в отчёт
  - **Depends on**: none
  - **Definition of Done**:
    - [ ] В отчёт попадают только секции из `settings.includedSections`
    - [ ] Если `includedSections` пустой - работает fallback на все найденные секции
    - [ ] Сортировка секций соответствует порядку в `includedSections`
  - **Touches**: `src/domain/services/ReportGeneratorService.ts`

- [ ] **Написать и обновить unit тесты**
  - **Business Value**: Уверенность что новая структура работает корректно во всех сценариях
  - **Depends on**: "Изменить алгоритм генерации: группировка по секциям вместо дней", "Сохранить совместимость с настройкой includedSections"
  - **Definition of Done**:
    - [ ] Новые тесты покрывают все сценарии из Testing Strategy
    - [ ] Существующие тесты обновлены для проверки новой структуры
    - [ ] Все тесты проходят (`npm test`)
  - **Touches**: `tests/unit/domain/services/ReportGeneratorService.test.ts`

## Testing Strategy

**Unit тесты** с использованием Vitest (уже настроен в проекте):

- Написать тесты для новой структуры группировки по секциям
- Обновить существующие тесты в `ReportGeneratorService.test.ts` которые проверяют старый формат
- Сценарии для покрытия:
  - [ ] Одна секция с одним днём
  - [ ] Одна секция с несколькими днями
  - [ ] Несколько секций с несколькими днями
  - [ ] Пустые секции пропускаются
  - [ ] Секция пустая в конкретном дне (день не показывается)
  - [ ] Разные секции в разных днях
  - [ ] Порядок дней внутри секции (хронологический)
  - [ ] Порядок секций (как в `includedSections`)
  - [ ] Нет daily notes
  - [ ] Пустой `includedSections` (fallback на все секции)

## Notes
- Метод `generateNoteSection` будет полностью переписан на логику группировки по секциям
- Заголовки дней должны быть как элементы списка `- {дата}` с отступом для контента
- Между днями в одной секции не нужна линия разделителя `---`
- Между секциями `## {название}` нужна пустая строка для разделения
